jQuery(function(s){"use strict";try{var n=YouCanPay(wc_youcanpay_params.key,{locale:wc_youcanpay_params.youcanpay_locale||"auto"})}catch(e){return void console.log(e)}var t,o,i,e=Object.keys(wc_youcanpay_params.elements_options).length?wc_youcanpay_params.elements_options:{},r=Object.keys(wc_youcanpay_params.sepa_elements_options).length?wc_youcanpay_params.sepa_elements_options:{},a=n.elements(e),c=a.create("iban",r),m={getAjaxURL:function(e){return wc_youcanpay_params.ajaxurl.toString().replace("%%endpoint%%","wc_youcanpay_"+e)},unmountElements:function(){"yes"===wc_youcanpay_params.inline_cc_form?t.unmount("#youcanpay-card-element"):(t.unmount("#youcanpay-card-element"),o.unmount("#youcanpay-exp-element"),i.unmount("#youcanpay-cvc-element"))},mountElements:function(){s("#youcanpay-card-element").length&&("yes"!==wc_youcanpay_params.inline_cc_form?(t.mount("#youcanpay-card-element"),o.mount("#youcanpay-exp-element"),i.mount("#youcanpay-cvc-element")):t.mount("#youcanpay-card-element"))},createElements:function(){var e={base:{iconColor:"#666EE8",color:"#31325F",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}},r={focus:"focused",empty:"empty",invalid:"invalid"},e=wc_youcanpay_params.elements_styling||e,r=wc_youcanpay_params.elements_classes||r;"yes"===wc_youcanpay_params.inline_cc_form?(t=a.create("card",{style:e,hidePostalCode:!0})).addEventListener("change",function(e){m.onCCFormChange(),e.error&&s(document.body).trigger("youcanpayError",e)}):(t=a.create("cardNumber",{style:e,classes:r}),o=a.create("cardExpiry",{style:e,classes:r}),i=a.create("cardCvc",{style:e,classes:r}),t.addEventListener("change",function(e){m.onCCFormChange(),m.updateCardBrand(e.brand),e.error&&s(document.body).trigger("youcanpayError",e)}),o.addEventListener("change",function(e){m.onCCFormChange(),e.error&&s(document.body).trigger("youcanpayError",e)}),i.addEventListener("change",function(e){m.onCCFormChange(),e.error&&s(document.body).trigger("youcanpayError",e)})),"yes"===wc_youcanpay_params.is_checkout?s(document.body).on("updated_checkout",function(){s("#youcanpay-card-element").children().length||(t&&m.unmountElements(),m.mountElements(),s("#youcanpay-iban-element").length&&c.mount("#youcanpay-iban-element"))}):(s("form#add_payment_method").length||s("form#order_review").length)&&(m.mountElements(),s("#youcanpay-iban-element").length&&c.mount("#youcanpay-iban-element"))},updateCardBrand:function(e){var r={visa:"youcanpay-visa-brand",mastercard:"youcanpay-mastercard-brand",amex:"youcanpay-amex-brand",discover:"youcanpay-discover-brand",diners:"youcanpay-diners-brand",jcb:"youcanpay-jcb-brand",unknown:"youcanpay-credit-card-brand"},t=s(".youcanpay-card-brand"),e=e in r?r[e]:"youcanpay-credit-card-brand";s.each(r,function(e,r){t.removeClass(r)}),t.addClass(e)},init:function(){"yes"!==wc_youcanpay_params.is_change_payment_page&&"yes"!==wc_youcanpay_params.is_pay_for_order_page||s(document.body).trigger("wc-credit-card-form-init"),s("form.woocommerce-checkout").length&&(this.form=s("form.woocommerce-checkout")),s("form.woocommerce-checkout").on("checkout_place_order_youcanpay checkout_place_order_youcanpay_bancontact checkout_place_order_youcanpay_sofort checkout_place_order_youcanpay_giropay checkout_place_order_youcanpay_ideal checkout_place_order_youcanpay_standalone checkout_place_order_youcanpay_sepa",this.onSubmit),s("form#order_review").length&&(this.form=s("form#order_review")),s("form#order_review, form#add_payment_method").on("submit",this.onSubmit),s("form#add_payment_method").length&&(this.form=s("form#add_payment_method")),s("form.woocommerce-checkout").on("change",this.reset),s(document).on("youcanpayError",this.onError).on("checkout_error",this.reset),c.on("change",this.onSepaError),(s("#early_renewal_modal_submit[data-payment-method]").length?s("#early_renewal_modal_submit[data-payment-method=youcanpay]"):s("#early_renewal_modal_submit")).on("click",this.onEarlyRenewalSubmit),m.createElements(),window.addEventListener("hashchange",m.onHashChange),m.maybeConfirmIntent()},isYouCanPayChosen:function(){return s("#payment_method_youcanpay, #payment_method_youcanpay_bancontact, #payment_method_youcanpay_sofort, #payment_method_youcanpay_giropay, #payment_method_youcanpay_ideal, #payment_method_youcanpay_standalone, #payment_method_youcanpay_sepa, #payment_method_youcanpay_eps, #payment_method_youcanpay_multibanco").is(":checked")||s("#payment_method_youcanpay").is(":checked")&&"new"===s('input[name="wc-youcanpay-payment-token"]:checked').val()||s("#payment_method_youcanpay_sepa").is(":checked")&&"new"===s('input[name="wc-youcanpay-payment-token"]:checked').val()},isYouCanPaySaveCardChosen:function(){return s("#payment_method_youcanpay").is(":checked")&&s('input[name="wc-youcanpay-payment-token"]').is(":checked")&&"new"!==s('input[name="wc-youcanpay-payment-token"]:checked').val()||s("#payment_method_youcanpay_sepa").is(":checked")&&s('input[name="wc-youcanpay_sepa-payment-token"]').is(":checked")&&"new"!==s('input[name="wc-youcanpay_sepa-payment-token"]:checked').val()},isYouCanPayCardChosen:function(){return s("#payment_method_youcanpay").is(":checked")},isBancontactChosen:function(){return s("#payment_method_youcanpay_bancontact").is(":checked")},isGiropayChosen:function(){return s("#payment_method_youcanpay_giropay").is(":checked")},isIdealChosen:function(){return s("#payment_method_youcanpay_ideal").is(":checked")},isSofortChosen:function(){return s("#payment_method_youcanpay_sofort").is(":checked")},isStandaloneChosen:function(){return s("#payment_method_youcanpay_standalone").is(":checked")},isSepaChosen:function(){return s("#payment_method_youcanpay_sepa").is(":checked")},isP24Chosen:function(){return s("#payment_method_youcanpay_p24").is(":checked")},isEpsChosen:function(){return s("#payment_method_youcanpay_eps").is(":checked")},isMultibancoChosen:function(){return s("#payment_method_youcanpay_multibanco").is(":checked")},hasSource:function(){return 0<s("input.youcanpay-source").length},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){m.isMobile()||m.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){m.form&&m.form.unblock()},getSelectedPaymentElement:function(){return s('.payment_methods input[name="payment_method"]:checked')},getOwnerDetails:function(){var e=s("#billing_first_name").length?s("#billing_first_name").val():wc_youcanpay_params.billing_first_name,r=s("#billing_last_name").length?s("#billing_last_name").val():wc_youcanpay_params.billing_last_name,t={name:"",address:{},email:"",phone:""};return t.name=e,t.name=e&&r?e+" "+r:s("#youcanpay-payment-data").data("full-name"),t.email=s("#billing_email").val(),t.phone=s("#billing_phone").val(),(void 0===t.phone||t.phone.length<=0)&&delete t.phone,(void 0===t.email||t.email.length<=0)&&(s("#youcanpay-payment-data").data("email").length?t.email=s("#youcanpay-payment-data").data("email"):delete t.email),(void 0===t.name||t.name.length<=0)&&delete t.name,t.address.line1=s("#billing_address_1").val()||wc_youcanpay_params.billing_address_1,t.address.line2=s("#billing_address_2").val()||wc_youcanpay_params.billing_address_2,t.address.state=s("#billing_state").val()||wc_youcanpay_params.billing_state,t.address.city=s("#billing_city").val()||wc_youcanpay_params.billing_city,t.address.postal_code=s("#billing_postcode").val()||wc_youcanpay_params.billing_postcode,t.address.country=s("#billing_country").val()||wc_youcanpay_params.billing_country,{owner:t}},createSource:function(){var e=m.getOwnerDetails();return m.isSepaChosen()?(e.currency=s("#youcanpay-sepa_debit-payment-data").data("currency"),e.mandate={notification_method:wc_youcanpay_params.sepa_mandate_notification},e.type="sepa_debit",n.createSource(c,e).then(m.sourceResponse)):n.createSource(t,e).then(m.sourceResponse)},sourceResponse:function(e){e.error?s(document.body).trigger("youcanpayError",e):(m.reset(),m.form.append(s('<input type="hidden" />').addClass("youcanpay-source").attr("name","youcanpay_source").val(e.source.id)),s("form#add_payment_method").length||s("#wc-youcanpay-change-payment-method").length?m.sourceSetup(e):m.form.trigger("submit"))},sourceSetup:function(r){var e={error:{type:"api_connection_error"}};s.post({url:m.getAjaxURL("create_setup_intent"),dataType:"json",data:{youcanpay_source_id:r.source.id,nonce:wc_youcanpay_params.add_card_nonce},error:function(){s(document.body).trigger("youcanpayError",e)}}).done(function(e){return"success"===e.status?(s("form#add_payment_method").length&&s(m.form).off("submit",m.form.onSubmit),void m.form.trigger("submit")):void("requires_action"===e.status?n.confirmCardSetup(e.client_secret,{payment_method:r.source.id}).then(function(e){e.error?s(document.body).trigger("youcanpayError",e):(s("form#add_payment_method").length&&s(m.form).off("submit",m.form.onSubmit),m.form.trigger("submit"))}).catch(function(e){console.log(e),s(document.body).trigger("youcanpayError",{error:e})}):s(document.body).trigger("youcanpayError",e))})},onSubmit:function(){return!m.isYouCanPayChosen()||(!(!m.isYouCanPaySaveCardChosen()&&!m.hasSource())||(!!(m.isBancontactChosen()||m.isGiropayChosen()||m.isIdealChosen()||m.isStandaloneChosen()||m.isSofortChosen()||m.isP24Chosen()||m.isEpsChosen()||m.isMultibancoChosen())||(m.block(),m.createSource(),!1)))},onCCFormChange:function(){m.reset()},reset:function(){s(".wc-youcanpay-error, .youcanpay-source").remove()},onSepaError:function(e){var r=m.getSelectedPaymentElement().parents("li").eq(0).find(".youcanpay-source-errors");e.error?(console.log(e.error.message),s(r).html('<ul class="woocommerce_error woocommerce-error wc-youcanpay-error"><li /></ul>'),s(r).find("li").text(e.error.message)):s(r).html("")},onError:function(e,r){var t,o=r.error.message,n=m.getSelectedPaymentElement().closest("li"),i=n.find(".woocommerce-SavedPaymentMethods-tokenInput"),a=s("body").hasClass("woocommerce-youcanpay-prb-clicked");if(t=a?(s("body").removeClass("woocommerce-youcanpay-prb-clicked"),s("div.woocommerce-notices-wrapper").first()):i.length?(t=i.filter(":checked")).closest(".woocommerce-SavedPaymentMethods-new").length?s("#wc-youcanpay-cc-form .youcanpay-source-errors"):t.closest("li").find(".youcanpay-source-errors"):n.find(".youcanpay-source-errors"),m.isSepaChosen()&&"invalid_owner_name"===r.error.code&&wc_youcanpay_params.hasOwnProperty(r.error.code)){n=s('<div><ul class="woocommerce-error"><li /></ul></div>');return n.find("li").text(wc_youcanpay_params[r.error.code]),void m.submitError(n.html())}"email_invalid"===r.error.code?o=wc_youcanpay_params.email_invalid:"invalid_request_error"!==r.error.type&&"api_connection_error"!==r.error.type&&"api_error"!==r.error.type&&"authentication_error"!==r.error.type&&"rate_limit_error"!==r.error.type||(o=wc_youcanpay_params.invalid_request_error),"card_error"===r.error.type&&wc_youcanpay_params.hasOwnProperty(r.error.code)&&(o=wc_youcanpay_params[r.error.code]),"validation_error"===r.error.type&&wc_youcanpay_params.hasOwnProperty(r.error.code)&&(o=wc_youcanpay_params[r.error.code]),m.reset(),s(".woocommerce-NoticeGroup-checkout").remove(),console.log(r.error.message),s(t).html('<ul class="woocommerce_error woocommerce-error wc-youcanpay-error"><li /></ul>'),s(t).find("li").text(o),s(".wc-youcanpay-error").length&&s("html, body").animate({scrollTop:s(".wc-youcanpay-error").offset().top-200},200),m.unblock(),s.unblockUI()},submitError:function(e){s(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),m.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),m.form.removeClass("processing").unblock(),m.form.find(".input-text, select, input:checkbox").trigger("blur");e="";s("#add_payment_method").length&&(e=s("#add_payment_method")),s("#order_review").length&&(e=s("#order_review")),(e=s("form.checkout").length?s("form.checkout"):e).length&&s("html, body").animate({scrollTop:e.offset().top-100},500),s(document.body).trigger("checkout_error"),m.unblock()},onHashChange:function(){var e,r,t=window.location.hash.match(/^#?confirm-(pi|si)-([^:]+):(.+)$/);!t||t.length<4||(e=t[1],r=t[2],t=decodeURIComponent(t[3]),window.location.hash="",m.openIntentModal(r,t,!1,"si"===e))},maybeConfirmIntent:function(){var e,r;s("#youcanpay-intent-id").length&&s("#youcanpay-intent-return").length&&(e=s("#youcanpay-intent-id").val(),r=s("#youcanpay-intent-return").val(),m.openIntentModal(e,r,!0,!1))},openIntentModal:function(e,r,t,o){n[o?"handleCardSetup":"handleCardPayment"](e).then(function(e){if(e.error)throw e.error;e=e[o?"setupIntent":"paymentIntent"];"requires_capture"!==e.status&&"succeeded"!==e.status||(window.location=r)}).catch(function(e){t?window.location=r:(s(document.body).trigger("youcanpayError",{error:e}),m.form&&m.form.removeClass("processing"),s.get(r+"&is_ajax"))})},onEarlyRenewalSubmit:function(e){return e.preventDefault(),s.ajax({url:s("#early_renewal_modal_submit").attr("href"),method:"get",success:function(e){e=JSON.parse(e);e.youcanpay_sca_required?m.openIntentModal(e.intent_secret,e.redirect_url,!0,!1):window.location=e.redirect_url}}),!1}};m.init()});
